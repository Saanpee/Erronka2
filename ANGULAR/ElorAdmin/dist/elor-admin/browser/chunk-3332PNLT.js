import{a as k}from"./chunk-PNKEXE34.js";import{e as d}from"./chunk-MJJXFY2L.js";import{E as c,Fa as m,Q as h,Qb as g,V as o,n as s,o as n,r as l,yb as i,z as u}from"./chunk-6OJ5OLV5.js";var v=(()=>{class t{constructor(r,e){this.http=r,this.router=e,this.apiUrl=k.apiUrl,this.currentUserSignal=m(null),this.currentUser=i(()=>this.currentUserSignal()),this.isAuthenticated=i(()=>this.currentUserSignal()!==null),this.userRole=i(()=>this.currentUserSignal()?.rola||null),this.mockUsers=[{id:1,izena:"Admin",abizena:"God",email:"god@elorrieta.eus",rola:"god",sortzeData:new Date,aktibo:!0},{id:2,izena:"Idazkaria",abizena:"Admin",email:"admin@elorrieta.eus",rola:"admin",sortzeData:new Date,aktibo:!0},{id:3,izena:"Mikel",abizena:"Irakasle",email:"irakasle@elorrieta.eus",rola:"irakasle",sortzeData:new Date,aktibo:!0},{id:4,izena:"Ane",abizena:"Ikasle",email:"ikasle@elorrieta.eus",rola:"ikasle",sortzeData:new Date,aktibo:!0}],this.loadStoredSession()}loadStoredSession(){let r=localStorage.getItem("currentUser"),e=localStorage.getItem("authToken");if(r&&e)try{let a=JSON.parse(r);this.currentUserSignal.set(a)}catch{this.clearSession()}}login(r){return this.mockLogin(r)}mockLogin(r){return s(null).pipe(c(500),l(()=>{let e=this.mockUsers.find(S=>S.email.toLowerCase()===r.email.toLowerCase());if(!e)throw new Error("Erabiltzailea ez da aurkitu");if(r.pasahitza!=="1234")throw new Error("Pasahitz okerra");let a=btoa(`${e.id}:${Date.now()}`);return this.saveSession(e,a),{token:a,user:e,message:"Saioa ongi hasi da"}}),u(e=>n(()=>new Error(e.message||"Errorea saioa hastean"))))}saveSession(r,e){localStorage.setItem("currentUser",JSON.stringify(r)),localStorage.setItem("authToken",e),this.currentUserSignal.set(r)}clearSession(){localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),this.currentUserSignal.set(null)}logout(){this.clearSession(),this.router.navigate(["/login"])}isLoggedIn(){return this.isAuthenticated()}getCurrentUser(){return this.currentUser()}getToken(){return localStorage.getItem("authToken")}hasRole(r){let e=this.userRole();return e?r.includes(e):!1}isAdmin(){return this.hasRole(["god","admin"])}isGod(){return this.userRole()==="god"}static{this.\u0275fac=function(e){return new(e||t)(o(g),o(d))}}static{this.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{v as a};
